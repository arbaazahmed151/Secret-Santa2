<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbzOAzqiQ2aFJU9omfQeDPC0h_PThCO7hpaCPmudBJXMZv-MRPozRN-BS_uJJsTGUjus/exec";

function drawChit() {
  const psInput = document.getElementById("psno");
  const psno = psInput.value.trim();

  if (psno === "") {
    alert("Enter PS Number");
    return;
  }

  let device = localStorage.getItem("ss_device");
  if (!device) {
    device = "DEV-" + Date.now();
    localStorage.setItem("ss_device", device);
  }

  const form = new FormData();
  form.append("psno", psno);
  form.append("device", device);

  fetch(API_URL + "?t=" + Date.now(), {
    method: "POST",
    body: form
  })
  .then(res => res.text())
  .then(res => {
    if (res === "INVALID_PS") {
      alert("âŒ Invalid PS Number");
    } else if (res === "PS_ALREADY_USED") {
      alert("âš ï¸ PS Number already used");
    } else if (res === "NO_NAMES_LEFT") {
      alert("ğŸ„ All names assigned");
    } else if (res === "CONFIG_ERROR") {
      alert("âš™ï¸ Configuration error (sheet names)");
    } else {
      document.getElementById("result").innerText =
        "ğŸ You got: " + res;
    }
  })
  .catch(err => {
    console.error(err);
    alert("âŒ Network error");
  });
}
</script>
